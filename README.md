# System Design социальной сети для курса по System Design

## Функциональные требования

- публикация поста с фотографией, небольшим описанием и привязкой к конкретному месту путешествия;
- оценка и комментарии постов других путешественников;
- подписка на других путешественников, чтобы следить за их активностью;
- поиск популярных мест для путешествий и просмотр постов с этих мест;
- просмотр ленты других путешественников и ленты пользователя, основанной на подписках в обратном хронологическом порядке;

## Нефункциональные требования
- DAU 10 000 000
- Доступность 99.95
- Данные храним всегда
- Сезонность: летом и в новогодние праздники x3
- Аудитория СНГ
- Активность:
    - Пользователь в среднем раз в неделю публикует пост
    - Пользователь в среднем 5 раз в сутки смотрит ленту
    - Пользователь в среднем оставлят 3 комментария в сутки
    - Пользователь в среднем читает 10 комментария в сутки
    - Пользователь в среднем ставит 10 лайков в сутки
    - Пользователь в среднем ищет популярные места для путешествий раз в месяц
    - Пользователь в среднем совершает 2 подписки (или отписки) в сутки
    - Подробно просматривает 5 постов из ленты (загружает 5 фотографий)
- Лимиты:
    - Фотография в посте - максимум 2 Мб
    - Количество фотографий в посте - 1
    - Описание - максимум 1000 символов
    - Комментарий - в среднем 100 символов
    - У пользователя может быть максимум 100 000 подписчиков и 100 000 подписок
- Тайминги:
    - Создание поста - 3с
    - Получение первых 20 постов в ленте - 2с
    - Оценка поста / комментарий / подписка - 1с

## Нагрузка
### Посты
- RPS (write) = 10 000 000 / 7 / 86400 = 17
- RPS (read) = 10 000 000 * 5 / 86400 = 579
### Реакции
- RPS (write) = 10 000 000 * 10 / 86400 = 1158
### Комментарии
- RPS (write) = 10 000 000 * 3 / 86400 = 347
- RPS (read) = 10 000 000 * 10 / 86400 = 1158
### Поиск популярных мест
- RPS (read) = 10 000 000 / 30 / 86400 = 4
### Подписки
- RPS (write) = 10 000 000 * 2 / 86400 = 231

## Траффик
### Посты
- Модель:
    - id 8b
    - user_id 8b
    - img_url 256b
    - description 2000b
    - location 16b
    - created_at 8b
    - ВСЕГО: 2296b

- write (meta) = 17 * 2296b = 39032 = 0.04 Мб/c
- write (media) = 17 * 2Мб = 34 Мб/c

- read (meta) = 579 * 2296b * 20 (постов на странице) = 26587680 = 27 Мб/c
- read (media) = 579 * 2Мб * 5 = 23880 Мб/c = 5.7 Гб/c

### Реакции
- Модель
    - user_id 8b
    - post_id 8b
    - created_at 8b
    - ВСЕГО: 24b

- write = 1158 * 24b = 27792 = 0.03 Мб/с

### Комментарии
- Модель
    - user_id 8b
    - post_id 8b
    - text 200b
    - created_at 8b
    - ВСЕГО: 224b

- write = 347 * 224b = 77728 = 0.03 Мб/с
- read = 1158 * 224b = 259392 = 0.3 Мб/с

### Поиск популярных мест (по 10 шт.)
- Модель
    - img_url 256b
    - description 1000b
    - location 16b
    - ВСЕГО: 1272b

- read (meta) = 4 * 1272b * 10 = 50880 = 0,05 Мб/с
- read (media) = 4 * 2Мб * 10 = 80 Мб/с

### Подписки
- Модель
    - user_id 8b
    - author_id 8b
    - created_at 8b
    - ВСЕГО: 24b

- write = 231 * 24b = 5544 = 0,005 Мб/с

## Capacity
### Media_DB

Per year = 34 Мб/c * 86400 * 365 = 1072224000Mb = 1072 Тб

```
HDD:
IOPS = 17 + 597 = 614 (7)
Throughput = 34 Мб/c + 5.7 Гб/c = 5.7 Гб/c (57)
Capacity = 1072Tb (34)
HDD = 57
```

```
SSD (SATA):
IOPS = 17 + 597 = 614 (1)
Throughput = 34 Мб/c + 5.7 Гб/c = 5.7 Гб/c (6)
Capacity = 1072Tb (11)
SSD (SATA) = 11
```

```
SSD (nVME):
IOPS = 17 + 597 = 614 (1)
Throughput = 34 Мб/c + 5.7 Гб/c = 5.7 Гб/c (2)
Capacity = 1072Tb (36)
SSD (nVME) = 36
```

### Reaction_DB

Per year = (0.03 Мб/с + 0.03 Мб/с) * 86400 * 365 = 1892160 Мб = 1,8 Гб
```
HDD:
IOPS = 1158 + 347 + 1158 = 2663 (27)
Throughput = 0.03 Мб/с + 0.03 Мб/с + 0.3 Мб/с = 0.36 Мб/c (1)
Capacity = 1.8 Гб (1)
HDD = 27
```

```
SSD (SATA):
IOPS = 1158 + 347 + 1158 = 2663 (3)
Throughput = 0.03 Мб/с + 0.03 Мб/с + 0.3 Мб/с = 0.36 Мб/c (1)
Capacity = 1.8 Гб (1)
SSD (SATA) = 3
```

```
SSD (nVME):
IOPS = 1158 + 347 + 1158 = 2663 (1)
Throughput = 0.03 Мб/с + 0.03 Мб/с + 0.3 Мб/с = 0.36 Мб/c (1)
Capacity = 1.8 Гб (1)
SSD (nVME) = 1
```

### Post_DB

Per year = (0.04 Мб/c + 0.005 Мб/c) * 86400 * 365 = 1419120 Мб = 1,4 Гб
```
HDD:
IOPS = 17 + 579 + 4 + 231 = 831 (9)
Throughput = 28 Мб/c (1)
Capacity = 1.4 Гб (1)
HDD = 9
```

```
SSD (SATA):
IOPS = 17 + 579 + 4 + 231 = 831 (1)
Throughput = 28 Мб/c (1)
Capacity = 1.4 Гб (1)
SSD (SATA) = 1
```

```
SSD (nVME):
IOPS = 17 + 579 + 4 + 231 = 831 (1)
Throughput = 28 Мб/c (1)
Capacity = 1.4 Гб (1)
SSD (nVME) = 1
```